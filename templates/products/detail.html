{% extends "base.html" %}

{% block title %}{{ product.name }} - –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω –ö–æ–ª—ë—Å–∏–∫–∏{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <h1 class="card-title">{{ product.name }}</h1>
                <p class="card-text">{{ product.description }}</p>
                <h3 class="text-primary">{{ "%.2f"|format(product.price) }} —Ä—É–±.</h3>
                <p class="text-muted">
                    –ü—Ä–æ–¥–∞–≤–µ—Ü: <strong>{{ product.owner.username }}</strong><br>
                    –î–æ–±–∞–≤–ª–µ–Ω–æ: {{ product.created_at.strftime('%d.%m.%Y %H:%M') }}<br>
                    –°—Ç–∞—Ç—É—Å: 
                    {% if product.is_available %}
                        <span class="badge bg-success">–î–æ—Å—Ç—É–ø–µ–Ω</span>
                    {% else %}
                        <span class="badge bg-secondary">–ü—Ä–æ–¥–∞–Ω</span>
                    {% endif %}
                </p>
                
                {% if session.username and session.username != product.owner.username and product.is_available %}
                    {% if current_user and current_user.can_afford(product.price) %}
                        <form method="POST" action="{{ url_for('products.buy_product', product_id=product.id) }}" class="mt-3">
                            <button type="submit" class="btn btn-primary btn-lg" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')">
                                üí≥ –ö—É–ø–∏—Ç—å –∑–∞ {{ "%.2f"|format(product.price) }} —Ä—É–±.
                            </button>
                        </form>
                    {% else %}
                        <div class="alert alert-warning mt-3">
                            <strong>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤</strong><br>
                            –£ –≤–∞—Å –Ω–∞ —Å—á–µ—Ç—É: {{ "%.2f"|format(user_balance) }} —Ä—É–±.<br>
                            –ù—É–∂–Ω–æ: {{ "%.2f"|format(product.price) }} —Ä—É–±.
                        </div>
                    {% endif %}
                {% elif session.username == product.owner.username %}
                    <div class="alert alert-info mt-3">
                        <strong>–≠—Ç–æ –≤–∞—à —Ç–æ–≤–∞—Ä</strong>
                    </div>
                {% elif not session.username %}
                    <div class="alert alert-warning mt-3">
                        <a href="{{ url_for('auth.login_page') }}" class="btn btn-primary">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥–∞–≤—Ü–µ</h5>
            </div>
            <div class="card-body">
                <p><strong>{{ product.owner.username }}</strong></p>
                <p class="text-muted">
                    –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: {{ product.owner.created_at.strftime('%d.%m.%Y') }}<br>
                    –¢–æ–≤–∞—Ä–æ–≤ –≤ –ø—Ä–æ–¥–∞–∂–µ: {{ product.owner.products|selectattr('is_available')|list|length }}
                </p>
            </div>
        </div>
        
        <div class="mt-3">
            <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–æ–≤–∞—Ä–∞–º</a>
        </div>
    </div>
</div>
{% endblock %}